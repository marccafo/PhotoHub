@page "/admin/queues"
@using PhotoHub.Blazor.Shared.Services
@inject IAuthService AuthService
@inject NavigationManager Navigation

<PageTitle>Administración - Colas de trabajo - PhotoHub</PageTitle>

@if (!_isAuthorized)
{
    <div class="mt-8">
        <MudText Typo="Typo.h5">Acceso Denegado</MudText>
        <MudText Typo="Typo.body1">Solo los administradores pueden acceder a esta página.</MudText>
        <MudButton Href="/" Variant="Variant.Filled" Color="Color.Primary" Class="mt-4">
            Volver al inicio
        </MudButton>
    </div>
}
else
{
    <div class="mt-4">
        <MudText Typo="Typo.h4" Class="mb-2">Colas de trabajo</MudText>
        <MudText Typo="Typo.body2" Class="mud-text-secondary">
            Ejecuta tareas de mantenimiento y análisis del servidor.
        </MudText>
    </div>

    <MudGrid Class="mt-4">
        <MudItem xs="12" md="6">
            <MudCard>
                <MudCardHeader>
                    <CardHeaderContent>
                        <MudText Typo="Typo.h6">Indexar</MudText>
                        <MudText Typo="Typo.body2">Escanea y actualiza el índice de archivos.</MudText>
                    </CardHeaderContent>
                </MudCardHeader>
                <MudCardActions Class="px-4 pb-4">
                    <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="@(() => Navigation.NavigateTo("/admin/queues/indexar"))">
                        Abrir
                    </MudButton>
                </MudCardActions>
            </MudCard>
        </MudItem>

        <MudItem xs="12" md="6">
            <MudCard>
                <MudCardHeader>
                    <CardHeaderContent>
                        <MudText Typo="Typo.h6">Generar miniaturas</MudText>
                        <MudText Typo="Typo.body2">Crea miniaturas faltantes.</MudText>
                    </CardHeaderContent>
                </MudCardHeader>
                <MudCardActions Class="px-4 pb-4">
                    <MudButton Variant="Variant.Outlined" Color="Color.Secondary" Disabled="true">
                        Próximamente
                    </MudButton>
                </MudCardActions>
            </MudCard>
        </MudItem>

        <MudItem xs="12" md="6">
            <MudCard>
                <MudCardHeader>
                    <CardHeaderContent>
                        <MudText Typo="Typo.h6">Extracción de metadatos</MudText>
                        <MudText Typo="Typo.body2">Lee EXIF y otros metadatos.</MudText>
                    </CardHeaderContent>
                </MudCardHeader>
                <MudCardActions Class="px-4 pb-4">
                    <MudButton Variant="Variant.Outlined" Color="Color.Secondary" Disabled="true">
                        Próximamente
                    </MudButton>
                </MudCardActions>
            </MudCard>
        </MudItem>

        <MudItem xs="12" md="6">
            <MudCard>
                <MudCardHeader>
                    <CardHeaderContent>
                        <MudText Typo="Typo.h6">Detección de duplicados</MudText>
                        <MudText Typo="Typo.body2">Identifica archivos repetidos.</MudText>
                    </CardHeaderContent>
                </MudCardHeader>
                <MudCardActions Class="px-4 pb-4">
                    <MudButton Variant="Variant.Outlined" Color="Color.Secondary" Disabled="true">
                        Próximamente
                    </MudButton>
                </MudCardActions>
            </MudCard>
        </MudItem>

        <MudItem xs="12" md="6">
            <MudCard>
                <MudCardHeader>
                    <CardHeaderContent>
                        <MudText Typo="Typo.h6">Detección de caras</MudText>
                        <MudText Typo="Typo.body2">Detecta rostros en las fotos.</MudText>
                    </CardHeaderContent>
                </MudCardHeader>
                <MudCardActions Class="px-4 pb-4">
                    <MudButton Variant="Variant.Outlined" Color="Color.Secondary" Disabled="true">
                        Próximamente
                    </MudButton>
                </MudCardActions>
            </MudCard>
        </MudItem>

        <MudItem xs="12" md="6">
            <MudCard>
                <MudCardHeader>
                    <CardHeaderContent>
                        <MudText Typo="Typo.h6">Reconocimiento facial</MudText>
                        <MudText Typo="Typo.body2">Identifica personas conocidas.</MudText>
                    </CardHeaderContent>
                </MudCardHeader>
                <MudCardActions Class="px-4 pb-4">
                    <MudButton Variant="Variant.Outlined" Color="Color.Secondary" Disabled="true">
                        Próximamente
                    </MudButton>
                </MudCardActions>
            </MudCard>
        </MudItem>
    </MudGrid>
}

@code {
    private bool _isAuthorized = false;

    protected override async Task OnInitializedAsync()
    {
        if (!await AuthService.IsAuthenticatedAsync())
        {
            Navigation.NavigateTo("/login");
            return;
        }

        var currentUser = await AuthService.GetCurrentUserAsync();
        _isAuthorized = currentUser?.Role == "Admin";
    }
}
