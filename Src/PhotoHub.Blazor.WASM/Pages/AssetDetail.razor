@page "/asset/{AssetId:int}"
@using PhotoHub.Blazor.WASM.Services
@implements IDisposable
@inject IAssetService AssetService
@inject IAlbumService AlbumService
@inject ISnackbar Snackbar
@inject NavigationManager Navigation
@inject LayoutService LayoutService

<PageTitle>Detalle - PhotoHub</PageTitle>

@if (_loading && _asset == null)
{
    <div class="asset-detail-container">
        <MudProgressLinear Color="Color.Primary" Indeterminate="true" />
    </div>
}
else if (_asset != null)
{
    <div class="asset-detail-container" @onkeydown="HandleKeyDown" tabindex="0">
        <style>
            .asset-detail-container {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: #000;
                z-index: 1200;
                display: flex;
                flex-direction: column;
                outline: none;
                margin: -24px;
                width: calc(100% + 48px);
                height: calc(100% + 48px);
            }
            .asset-detail-content {
                flex-grow: 1;
                display: flex;
                align-items: center;
                justify-content: center;
                overflow: hidden;
                position: relative;
            }
            .asset-detail-image {
                max-width: 100%;
                max-height: 100%;
                object-fit: contain;
                user-select: none;
            }
            video.asset-detail-image {
                outline: none;
                background-color: black;
            }
            .asset-info-drawer {
                width: 360px;
                background-color: #1a1a1a;
                height: 100%;
                overflow-y: auto;
                transition: transform 0.3s ease;
                position: absolute;
                right: 0;
                top: 0;
                z-index: 40;
                border-left: 1px solid #333;
                color: #e1e1e1;
            }
            .asset-info-drawer.closed {
                transform: translateX(100%);
            }
            .nav-button {
                position: absolute;
                top: 50%;
                transform: translateY(-50%);
                z-index: 20;
                background-color: rgba(0,0,0,0.3);
                color: white;
                transition: opacity 0.3s ease, background-color 0.2s;
            }
            .nav-button:hover {
                background-color: rgba(0,0,0,0.6);
            }
            .nav-button.prev { left: 16px; }
            .nav-button.next { right: 16px; }
            .nav-button.hidden {
                opacity: 0;
                pointer-events: none;
            }
        </style>

        <div class="asset-detail-content" @onclick="ToggleToolbar">
            <span @onclick:stopPropagation="true">
                <MudIconButton Icon="@Icons.Material.Filled.ChevronLeft" 
                               Class="@GetNavButtonClass(true)" 
                               Size="Size.Large"
                               OnClick="NavigatePrev"
                               Disabled="@(_prevAsset == null)" />
            </span>

            @if (_asset.Type == "VIDEO")
            {
                <video controls autoplay class="asset-detail-image">
                    <source src="@_asset.ContentUrl" type="video/mp4">
                    Tu navegador no soporta la reproducción de videos.
                </video>
            }
            else if (_asset.HasThumbnails || _asset.Type == "IMAGE")
            {
                <img src="@(_asset.Type == "IMAGE" ? _asset.ContentUrl : _asset.ThumbnailUrl)" 
                     alt="@_asset.FileName" class="asset-detail-image" />
            }
            else
            {
                <MudIcon Icon="@GetAssetIcon(_asset.Type)" Size="Size.Large" Color="Color.Default" Style="width: 128px; height: 128px;" />
            }

            <span @onclick:stopPropagation="true">
                <MudIconButton Icon="@Icons.Material.Filled.ChevronRight" 
                               Class="@GetNavButtonClass(false)" 
                               Size="Size.Large"
                               OnClick="NavigateNext"
                               Disabled="@(_nextAsset == null)" />
            </span>
        </div>

        <div class="asset-info-drawer @(_infoOpen ? "" : "closed")">
            <div class="pa-4">
                <div class="d-flex align-center mb-4">
                    <MudText Typo="Typo.h6">Información</MudText>
                    <MudSpacer />
                    <MudIconButton Icon="@Icons.Material.Filled.Close" Size="Size.Small" Color="Color.Inherit" OnClick="ToggleInfo" />
                </div>

                <MudText Typo="Typo.subtitle1" Class="font-weight-bold mb-1">Detalles del archivo</MudText>
                <MudList T="string" Dense="true" ReadOnly="true">
                    <MudListItem Icon="@Icons.Material.Filled.InsertDriveFile" IconColor="Color.Info">
                        <MudText Typo="Typo.body2">@_asset.FileName</MudText>
                    </MudListItem>
                    <MudListItem Icon="@Icons.Material.Filled.CalendarToday" IconColor="Color.Info">
                        <MudText Typo="Typo.body2">@_asset.DisplayDate</MudText>
                    </MudListItem>
                    <MudListItem Icon="@Icons.Material.Filled.SdStorage" IconColor="Color.Info">
                        <MudText Typo="Typo.body2">@_asset.FileSizeFormatted</MudText>
                    </MudListItem>
                    @if (!string.IsNullOrEmpty(_asset.FolderPath))
                    {
                        <MudListItem Icon="@Icons.Material.Filled.Folder" IconColor="Color.Info">
                            <MudText Typo="Typo.body2">@_asset.FolderPath</MudText>
                        </MudListItem>
                    }
                </MudList>

                @if (_asset.Exif != null)
                {
                    <MudDivider Class="my-4" Style="background-color: #333;" />
                    <MudText Typo="Typo.subtitle1" Class="font-weight-bold mb-1">Información técnica</MudText>
                    <MudList T="string" Dense="true" ReadOnly="true">
                        @if (_asset.Exif.CameraMake != null)
                        {
                            <MudListItem Icon="@Icons.Material.Filled.Camera" IconColor="Color.Info">
                                <MudText Typo="Typo.body2">@_asset.Exif.CameraMake @_asset.Exif.CameraModel</MudText>
                            </MudListItem>
                        }
                        @if (_asset.Exif.Width.HasValue)
                        {
                            <MudListItem Icon="@Icons.Material.Filled.AspectRatio" IconColor="Color.Info">
                                <MudText Typo="Typo.body2">@_asset.Exif.Width x @_asset.Exif.Height</MudText>
                            </MudListItem>
                        }
                        @if (_asset.Exif.Iso.HasValue || _asset.Exif.Aperture.HasValue || _asset.Exif.ShutterSpeed.HasValue)
                        {
                            <MudListItem Icon="@Icons.Material.Filled.Settings" IconColor="Color.Info">
                                <MudText Typo="Typo.body2">
                                    @( _asset.Exif.Iso.HasValue ? $"ISO {_asset.Exif.Iso} " : "" )
                                    @( _asset.Exif.Aperture.HasValue ? $"f/{_asset.Exif.Aperture:0.#} " : "" )
                                    @if (_asset.Exif.ShutterSpeed.HasValue)
                                    {
                                        var ss = _asset.Exif.ShutterSpeed.Value;
                                        var ssText = ss < 1 ? $"1/{(int)Math.Round(1 / ss)}s" : $"{ss:0.#}s";
                                        <span>@ssText </span>
                                    }
                                    @( _asset.Exif.FocalLength.HasValue ? $"{_asset.Exif.FocalLength:0.#}mm" : "" )
                                </MudText>
                            </MudListItem>
                        }
                    </MudList>

                    @if (_asset.Exif.Latitude.HasValue && _asset.Exif.Longitude.HasValue)
                    {
                        <MudDivider Class="my-4" Style="background-color: #333;" />
                        <MudText Typo="Typo.subtitle1" Class="font-weight-bold mb-1">Ubicación</MudText>
                        <MudList T="string" Dense="true" ReadOnly="true">
                            <MudListItem Icon="@Icons.Material.Filled.LocationOn" IconColor="Color.Info">
                                <div class="d-flex flex-column">
                                    <MudText Typo="Typo.body2">@_asset.Exif.Latitude.Value.ToString("F6"), @_asset.Exif.Longitude.Value.ToString("F6")</MudText>
                                    @if (_asset.Exif.Altitude.HasValue)
                                    {
                                        <MudText Typo="Typo.caption" Class="mud-text-secondary">Altitud: @_asset.Exif.Altitude.Value.ToString("F0") m</MudText>
                                    }
                                    <MudLink Href="@($"https://www.google.com/maps/search/?api=1&query={_asset.Exif.Latitude},{_asset.Exif.Longitude}")" 
                                             Target="_blank" Underline="Underline.Hover" Color="Color.Primary" Class="mt-1">
                                        Ver en Google Maps
                                    </MudLink>
                                </div>
                            </MudListItem>
                        </MudList>
                    }

                    @if (!string.IsNullOrEmpty(_asset.Exif.Description))
                    {
                        <MudDivider Class="my-4" Style="background-color: #333;" />
                        <MudText Typo="Typo.subtitle1" Class="font-weight-bold mb-1">Descripción</MudText>
                        <MudText Typo="Typo.body2" Class="px-4 py-2" Style="font-style: italic;">@_asset.Exif.Description</MudText>
                    }
                }

                @if (_asset.Tags.Any())
                {
                    <MudDivider Class="my-4" Style="background-color: #333;" />
                    <MudText Typo="Typo.subtitle1" Class="font-weight-bold mb-2">Etiquetas</MudText>
                    <div class="d-flex flex-wrap gap-2">
                        @foreach (var tag in _asset.Tags)
                        {
                            <MudChip T="string" Size="Size.Small" Variant="Variant.Text" Color="Color.Primary">@tag</MudChip>
                        }
                    </div>
                }
            </div>
        </div>
    </div>
}
else
{
    <MudAlert Severity="Severity.Error" Class="mt-4">No se pudo cargar la información del archivo.</MudAlert>
    <MudButton StartIcon="@Icons.Material.Filled.ArrowBack" Color="Color.Primary" OnClick="GoBack" Class="mt-2">Volver al Timeline</MudButton>
}

@code {
    [Parameter] public int AssetId { get; set; }
    [SupplyParameterFromQuery] public string? Path { get; set; }
    
    private PhotoHub.Blazor.Shared.Models.AssetDetail? _asset;
    private bool _loading = true;
    private bool _infoOpen = false;
    private bool _toolbarVisible = true;
    private bool _syncing = false;
    
    private TimelineItem? _prevAsset;
    private TimelineItem? _nextAsset;
    private List<TimelineItem> _allAssets = new();

    protected override async Task OnInitializedAsync()
    {
        UpdateNavbar();
        await LoadAsset();
    }

    protected override async Task OnParametersSetAsync()
    {
        UpdateNavbar();
        await LoadAsset();
    }

    public void Dispose()
    {
        LayoutService.ResetNavbar();
    }

    private void UpdateNavbar()
    {
        // Forzar actualización del estado antes de renderizar el navbar
        var currentSyncStatus = _asset?.SyncStatus ?? AssetSyncStatus.Pending;
        var assetId = _asset?.Id ?? 0;
        
        LayoutService.SetCustomNavbar(
            @<text>
                <MudIconButton Icon="@Icons.Material.Filled.ArrowBack" Color="Color.Inherit" OnClick="GoBack" Edge="Edge.Start" />
                <MudSpacer />
                
                <div class="d-flex align-center gap-1" @onclick:stopPropagation="true">
                    @if (_asset != null && assetId == 0 && currentSyncStatus == AssetSyncStatus.Pending)
                    {
                        <MudTooltip Text="Sincronizar ahora">
                            <MudIconButton Icon="@Icons.Material.Filled.CloudUpload" 
                                           Color="Color.Default" 
                                           OnClick="SyncAsset"
                                           Disabled="@_syncing" />
                        </MudTooltip>
                    }
                    else if (_asset != null && (assetId == 0 && currentSyncStatus == AssetSyncStatus.Copied))
                    {
                        <MudTooltip Text="Pendiente de indexar">
                            <span @onclick:stopPropagation="true">
                                <MudIconButton Icon="@Icons.Material.Outlined.Schedule" 
                                               Color="Color.Default" 
                                               OnClick="NavigateToIndex" />
                            </span>
                        </MudTooltip>
                    }

                    <MudTooltip Text="Compartir">
                        <MudIconButton Icon="@Icons.Material.Outlined.Share" Color="Color.Inherit" />
                    </MudTooltip>
                    
                    <MudTooltip Text="Acercar">
                        <MudIconButton Icon="@Icons.Material.Outlined.ZoomIn" Color="Color.Inherit" />
                    </MudTooltip>
                    
                    <MudTooltip Text="Copiar">
                        <MudIconButton Icon="@Icons.Material.Outlined.ContentCopy" Color="Color.Inherit" />
                    </MudTooltip>

                    <MudTooltip Text="Información">
                        <MudIconButton Icon="@(_infoOpen ? Icons.Material.Filled.Info : Icons.Material.Outlined.Info)" 
                                       Color="Color.Inherit" OnClick="ToggleInfo" />
                    </MudTooltip>
                    
                    @if (_asset != null && _asset.Id > 0)
                    {
                        <MudTooltip Text="Favorito">
                            <MudToggleIconButton ToggledIcon="@Icons.Material.Filled.Favorite" 
                                                 Icon="@Icons.Material.Outlined.FavoriteBorder" 
                                                 Color="Color.Inherit" ToggledColor="Color.Error" />
                        </MudTooltip>
                    }

                    <MudTooltip Text="Descargar">
                        <MudIconButton Icon="@Icons.Material.Outlined.Download" Color="Color.Inherit" />
                    </MudTooltip>

                    @if (_asset != null && _asset.Id > 0)
                    {
                        <MudTooltip Text="Eliminar">
                            <MudIconButton Icon="@Icons.Material.Outlined.Delete" Color="Color.Inherit" />
                        </MudTooltip>

                        <MudMenu Icon="@Icons.Material.Outlined.MoreVert" Color="Color.Inherit" AnchorOrigin="Origin.BottomRight" TransformOrigin="Origin.TopRight">
                            <MudMenuItem Icon="@Icons.Material.Outlined.Edit">Editar fecha y hora</MudMenuItem>
                            <MudMenuItem Icon="@Icons.Material.Outlined.LocationOn">Editar ubicación</MudMenuItem>
                            <MudMenuItem Icon="@Icons.Material.Outlined.Add" OnClick="OpenAddToAlbumDialog">Añadir a álbum</MudMenuItem>
                            <MudMenuItem Icon="@Icons.Material.Outlined.Archive">Archivar</MudMenuItem>
                        </MudMenu>
                    }
                </div>
            </text>
        );
    }

    private async Task LoadAsset()
    {
        try
        {
            _loading = true;
            if (AssetId > 0)
            {
                _asset = await AssetService.GetAssetDetailAsync(AssetId);
            }
            else if (!string.IsNullOrEmpty(Path))
            {
                _asset = await AssetService.GetPendingAssetDetailAsync(Path);
            }
            
            // Actualizar el navbar una vez cargado el asset para habilitar botones
            // Asegurar que se actualice después de cargar el asset
            if (_asset != null)
            {
                UpdateNavbar();
                StateHasChanged();
            }
            
            if (_allAssets.Count == 0)
            {
                _allAssets = await AssetService.GetTimelineAsync();
            }
            
            UpdateNavigation();
        }
        catch (Exception ex)
        {
            Snackbar.Add($"Error al cargar archivo: {ex.Message}", Severity.Error);
        }
        finally
        {
            _loading = false;
        }
    }

    private void UpdateNavigation()
    {
        int currentIndex = -1;
        if (AssetId > 0)
        {
            currentIndex = _allAssets.FindIndex(a => a.Id == AssetId);
        }
        else if (!string.IsNullOrEmpty(Path))
        {
            currentIndex = _allAssets.FindIndex(a => a.FullPath == Path);
        }

        if (currentIndex != -1)
        {
            _prevAsset = currentIndex > 0 ? _allAssets[currentIndex - 1] : null;
            _nextAsset = currentIndex < _allAssets.Count - 1 ? _allAssets[currentIndex + 1] : null;
        }
    }

    private void NavigatePrev()
    {
        NavigateToAsset(_prevAsset);
    }

    private void NavigateNext()
    {
        NavigateToAsset(_nextAsset);
    }

    private void NavigateToAsset(TimelineItem? asset)
    {
        if (asset == null) return;

        if (asset.SyncStatus == AssetSyncStatus.Synced)
        {
            Navigation.NavigateTo($"/asset/{asset.Id}");
        }
        else
        {
            var encodedPath = System.Net.WebUtility.UrlEncode(asset.FullPath);
            Navigation.NavigateTo($"/asset/0?path={encodedPath}");
        }
    }

    private void HandleKeyDown(KeyboardEventArgs e)
    {
        if (e.Key == "ArrowLeft") NavigatePrev();
        else if (e.Key == "ArrowRight") NavigateNext();
        else if (e.Key == "Escape") GoBack();
    }

    private void GoBack()
    {
        Navigation.NavigateTo("/");
    }

    private void NavigateToIndex()
    {
        Navigation.NavigateTo("/index");
    }

    private void ToggleInfo()
    {
        _infoOpen = !_infoOpen;
        UpdateNavbar();
    }

    private void ToggleToolbar()
    {
        _toolbarVisible = !_toolbarVisible;
    }

    private async Task SyncAsset()
    {
        if (_asset == null || string.IsNullOrEmpty(_asset.FullPath) || _syncing) return;

        try
        {
            _syncing = true;
            UpdateNavbar();
            StateHasChanged();

            var result = await AssetService.SyncAssetAsync(_asset.FullPath);
            if (result != null && !string.IsNullOrEmpty(result.Message))
            {
                Snackbar.Add(result.Message, Severity.Success);
                
                // Si tiene AssetId, significa que ya estaba indexado, navegar a él
                if (result.AssetId.HasValue)
                {
                    Navigation.NavigateTo($"/asset/{result.AssetId.Value}");
                    return;
                }
                
                // Si no tiene AssetId, el archivo se copió pero aún no está indexado
                // Actualizar el estado del asset y recargar usando la nueva ruta
                if (!string.IsNullOrEmpty(result.TargetPath))
                {
                    // Recargar el asset con la nueva ruta para obtener el estado actualizado
                    // El endpoint AssetPendingEndpoint determinará automáticamente que está en Copied
                    Path = result.TargetPath;
                    AssetId = 0; // Asegurar que se use el path en lugar del ID
                    await LoadAsset();
                    
                    // Asegurar que el navbar se actualice después de cargar completamente
                    // Esperar un momento para que el estado se actualice
                    await Task.Delay(100);
                    UpdateNavbar();
                    StateHasChanged();
                }
                else
                {
                    // Si no hay TargetPath, actualizar el estado manualmente
                    if (_asset != null)
                    {
                        _asset.SyncStatus = AssetSyncStatus.Copied;
                    }
                    UpdateNavbar();
                    StateHasChanged();
                }
            }
            else
            {
                Snackbar.Add("Error al sincronizar el asset", Severity.Error);
            }
        }
        catch (Exception ex)
        {
            Snackbar.Add($"Error: {ex.Message}", Severity.Error);
        }
        finally
        {
            _syncing = false;
            UpdateNavbar();
            StateHasChanged();
        }
    }

    private string GetAssetIcon(string type)
    {
        return type == "IMAGE" ? Icons.Material.Filled.Image : Icons.Material.Filled.VideoLibrary;
    }

    private string GetNavButtonClass(bool isPrev)
    {
        var baseClass = isPrev ? "nav-button prev" : "nav-button next";
        var hasAsset = isPrev ? _prevAsset != null : _nextAsset != null;
        return _toolbarVisible && hasAsset ? baseClass : $"{baseClass} hidden";
    }

    // Add to Album functionality
    private bool _addToAlbumDialogVisible = false;
    private List<AlbumItem> _availableAlbums = new();
    private bool _loadingAlbums = false;
    private int? _selectedAlbumId = null;
    private bool _showCreateAlbum = false;
    private string _newAlbumName = "";
    private string? _newAlbumDescription = "";

    private async Task OpenAddToAlbumDialog()
    {
        if (_asset == null || _asset.Id == 0)
        {
            Snackbar.Add("Solo se pueden añadir fotos indexadas a álbumes", Severity.Info);
            return;
        }

        _addToAlbumDialogVisible = true;
        _loadingAlbums = true;
        _availableAlbums = await AlbumService.GetAlbumsAsync();
        _loadingAlbums = false;
    }

    private async Task AddToAlbum()
    {
        if (_asset == null || _asset.Id == 0 || !_selectedAlbumId.HasValue)
            return;

        var success = await AlbumService.AddAssetToAlbumAsync(_selectedAlbumId.Value, _asset.Id);
        if (success)
        {
            Snackbar.Add("Foto añadida al álbum correctamente", Severity.Success);
            _addToAlbumDialogVisible = false;
            _selectedAlbumId = null;
        }
        else
        {
            Snackbar.Add("Error al añadir la foto al álbum", Severity.Error);
        }
    }

    private async Task CreateAlbumAndAdd()
    {
        if (string.IsNullOrWhiteSpace(_newAlbumName))
        {
            Snackbar.Add("El nombre del álbum es obligatorio", Severity.Warning);
            return;
        }

        var album = await AlbumService.CreateAlbumAsync(_newAlbumName, _newAlbumDescription);
        if (album != null && _asset != null && _asset.Id > 0)
        {
            var success = await AlbumService.AddAssetToAlbumAsync(album.Id, _asset.Id);
            if (success)
            {
                Snackbar.Add("Álbum creado y foto añadida correctamente", Severity.Success);
                _addToAlbumDialogVisible = false;
                _showCreateAlbum = false;
                _newAlbumName = "";
                _newAlbumDescription = "";
                _selectedAlbumId = null;
            }
            else
            {
                Snackbar.Add("Álbum creado pero error al añadir la foto", Severity.Warning);
            }
        }
        else
        {
            Snackbar.Add("Error al crear el álbum", Severity.Error);
        }
    }
}

<MudDialog @bind-Visible="_addToAlbumDialogVisible" Options="new DialogOptions { MaxWidth = MaxWidth.Medium, FullWidth = true }">
    <TitleContent>
        <MudText Typo="Typo.h6">Añadir a Álbum</MudText>
    </TitleContent>
    <DialogContent>
        @if (!_showCreateAlbum)
        {
            @if (_loadingAlbums)
            {
                <MudProgressLinear Color="Color.Primary" Indeterminate="true" Class="my-4" />
            }
            else if (_availableAlbums.Any())
            {
                <MudRadioGroup T="int?" @bind-Value="_selectedAlbumId">
                    @foreach (var album in _availableAlbums)
                    {
                        <MudRadio T="int?" Value="@album.Id">
                            <div class="d-flex align-center gap-2">
                                @if (!string.IsNullOrEmpty(album.CoverThumbnailUrl))
                                {
                                    <img src="@album.CoverThumbnailUrl" 
                                         style="width: 48px; height: 48px; object-fit: cover; border-radius: 4px;" 
                                         alt="@album.Name" />
                                }
                                else
                                {
                                    <div style="width: 48px; height: 48px; display: flex; align-items: center; justify-content: center; background: var(--mud-palette-surface); border-radius: 4px;">
                                        <MudIcon Icon="@Icons.Material.Filled.Collections" Size="Size.Small" />
                                    </div>
                                }
                                <div>
                                    <MudText Typo="Typo.body1">@album.Name</MudText>
                                    <MudText Typo="Typo.caption" Class="mud-text-secondary">
                                        @album.AssetCount @(album.AssetCount == 1 ? "foto" : "fotos")
                                    </MudText>
                                </div>
                            </div>
                        </MudRadio>
                    }
                </MudRadioGroup>
            }
            else
            {
                <MudAlert Severity="Severity.Info" Class="mb-3">
                    No tienes ningún álbum. Crea uno nuevo para añadir esta foto.
                </MudAlert>
            }
            
            <MudDivider Class="my-3" />
            <MudButton Variant="Variant.Text" 
                       StartIcon="@Icons.Material.Filled.Add"
                       OnClick="@(() => _showCreateAlbum = true)"
                       FullWidth="true">
                Crear nuevo álbum
            </MudButton>
        }
        else
        {
            <MudTextField @bind-Value="_newAlbumName" 
                          Label="Nombre del álbum" 
                          Variant="Variant.Outlined" 
                          FullWidth="true"
                          Class="mb-3" />
            <MudTextField @bind-Value="_newAlbumDescription" 
                          Label="Descripción (opcional)" 
                          Variant="Variant.Outlined" 
                          FullWidth="true"
                          Lines="3" />
            <MudButton Variant="Variant.Text" 
                       StartIcon="@Icons.Material.Filled.ArrowBack"
                       OnClick="@(() => _showCreateAlbum = false)"
                       Class="mt-2">
                Volver a seleccionar álbum
            </MudButton>
        }
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="@(() => { _addToAlbumDialogVisible = false; _showCreateAlbum = false; _selectedAlbumId = null; })">
            Cancelar
        </MudButton>
        @if (_showCreateAlbum)
        {
            <MudButton Color="Color.Primary" Variant="Variant.Filled" OnClick="CreateAlbumAndAdd">
                Crear y Añadir
            </MudButton>
        }
        else
        {
            <MudButton Color="Color.Primary" 
                       Variant="Variant.Filled" 
                       OnClick="AddToAlbum"
                       Disabled="@(!_selectedAlbumId.HasValue)">
                Añadir
            </MudButton>
        }
    </DialogActions>
</MudDialog>
